/*! For license information please see server.bundle.mjs.LICENSE.txt */
(()=>{"use strict";const t=require("express"),n=require("body-parser"),e=require("crypto"),r=require("dotenv");function o(t){var n=t.headers["x-hub-signature-256"],r=JSON.stringify(t.body),o=e.createHmac("sha256",process.env.GITHUB_WEBHOOK_SECRET),i="sha256=".concat(o.update(r).digest("hex"));return e.timingSafeEqual(Buffer.from(n),Buffer.from(i))}r.config();const i=require("node-fetch");function c(){var t,n,e="function"==typeof Symbol?Symbol:{},r=e.iterator||"@@iterator",o=e.toStringTag||"@@toStringTag";function i(e,r,o,i){var c=r&&r.prototype instanceof f?r:f,s=Object.create(c.prototype);return a(s,"_invoke",function(e,r,o){var i,c,a,f=0,s=o||[],l=!1,p={p:0,n:0,v:t,a:v,f:v.bind(t,4),d:function(n,e){return i=n,c=0,a=t,p.n=e,u}};function v(e,r){for(c=e,a=r,n=0;!l&&f&&!o&&n<s.length;n++){var o,i=s[n],v=p.p,y=i[2];e>3?(o=y===r)&&(a=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=v&&((o=e<2&&v<i[1])?(c=0,p.v=r,p.n=i[1]):v<y&&(o=e<3||i[0]>r||r>y)&&(i[4]=e,i[5]=r,p.n=y,c=0))}if(o||e>1)return u;throw l=!0,r}return function(o,s,y){if(f>1)throw TypeError("Generator is already running");for(l&&1===s&&v(s,y),c=s,a=y;(n=c<2?t:a)||!l;){i||(c?c<3?(c>1&&(p.n=-1),v(c,a)):p.n=a:p.v=a);try{if(f=2,i){if(c||(o="next"),n=i[o]){if(!(n=n.call(i,a)))throw TypeError("iterator result is not an object");if(!n.done)return n;a=n.value,c<2&&(c=0)}else 1===c&&(n=i.return)&&n.call(i),c<2&&(a=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((n=(l=p.n<0)?a:e.call(r,p))!==u)break}catch(n){i=t,c=1,a=n}finally{f=1}}return{value:n,done:l}}}(e,o,i),!0),s}var u={};function f(){}function s(){}function l(){}n=Object.getPrototypeOf;var p=[][r]?n(n([][r]())):(a(n={},r,(function(){return this})),n),v=l.prototype=f.prototype=Object.create(p);function y(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,a(t,o,"GeneratorFunction")),t.prototype=Object.create(v),t}return s.prototype=l,a(v,"constructor",l),a(l,"constructor",s),s.displayName="GeneratorFunction",a(l,o,"GeneratorFunction"),a(v),a(v,o,"Generator"),a(v,r,(function(){return this})),a(v,"toString",(function(){return"[object Generator]"})),(c=function(){return{w:i,m:y}})()}function a(t,n,e,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}a=function(t,n,e,r){if(n)o?o(t,n,{value:e,enumerable:!r,configurable:!r,writable:!r}):t[n]=e;else{var i=function(n,e){a(t,n,(function(t){return this._invoke(n,e,t)}))};i("next",0),i("throw",1),i("return",2)}},a(t,n,e,r)}function u(t,n,e,r,o,i,c){try{var a=t[i](c),u=a.value}catch(t){return void e(t)}a.done?n(u):Promise.resolve(u).then(r,o)}function f(t){return s.apply(this,arguments)}function s(){var t;return t=c().m((function t(n){var e,r,o,a,u;return c().w((function(t){for(;;)switch(t.n){case 0:return r={"Content-Type":"application/json","x-goog-api-key":process.env.GEMINI_API_KEY},o={contents:[{parts:[{text:n}]}]},t.n=1,i("https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent",{method:"POST",headers:r,body:JSON.stringify(o)});case 1:return a=t.v,t.n=2,a.json();case 2:return u=t.v,t.a(2,(null===(e=u.candidates)||void 0===e||null===(e=e[0])||void 0===e||null===(e=e.content)||void 0===e||null===(e=e.parts)||void 0===e||null===(e=e[0])||void 0===e?void 0:e.text)||"No suggestions generated.")}}),t)})),s=function(){var n=this,e=arguments;return new Promise((function(r,o){var i=t.apply(n,e);function c(t){u(i,r,o,c,a,"next",t)}function a(t){u(i,r,o,c,a,"throw",t)}c(void 0)}))},s.apply(this,arguments)}function l(){var t,n,e="function"==typeof Symbol?Symbol:{},r=e.iterator||"@@iterator",o=e.toStringTag||"@@toStringTag";function i(e,r,o,i){var u=r&&r.prototype instanceof a?r:a,f=Object.create(u.prototype);return p(f,"_invoke",function(e,r,o){var i,a,u,f=0,s=o||[],l=!1,p={p:0,n:0,v:t,a:v,f:v.bind(t,4),d:function(n,e){return i=n,a=0,u=t,p.n=e,c}};function v(e,r){for(a=e,u=r,n=0;!l&&f&&!o&&n<s.length;n++){var o,i=s[n],v=p.p,y=i[2];e>3?(o=y===r)&&(u=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=t):i[0]<=v&&((o=e<2&&v<i[1])?(a=0,p.v=r,p.n=i[1]):v<y&&(o=e<3||i[0]>r||r>y)&&(i[4]=e,i[5]=r,p.n=y,a=0))}if(o||e>1)return c;throw l=!0,r}return function(o,s,y){if(f>1)throw TypeError("Generator is already running");for(l&&1===s&&v(s,y),a=s,u=y;(n=a<2?t:u)||!l;){i||(a?a<3?(a>1&&(p.n=-1),v(a,u)):p.n=u:p.v=u);try{if(f=2,i){if(a||(o="next"),n=i[o]){if(!(n=n.call(i,u)))throw TypeError("iterator result is not an object");if(!n.done)return n;u=n.value,a<2&&(a=0)}else 1===a&&(n=i.return)&&n.call(i),a<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=t}else if((n=(l=p.n<0)?u:e.call(r,p))!==c)break}catch(n){i=t,a=1,u=n}finally{f=1}}return{value:n,done:l}}}(e,o,i),!0),f}var c={};function a(){}function u(){}function f(){}n=Object.getPrototypeOf;var s=[][r]?n(n([][r]())):(p(n={},r,(function(){return this})),n),v=f.prototype=a.prototype=Object.create(s);function y(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,p(t,o,"GeneratorFunction")),t.prototype=Object.create(v),t}return u.prototype=f,p(v,"constructor",f),p(f,"constructor",u),u.displayName="GeneratorFunction",p(f,o,"GeneratorFunction"),p(v),p(v,o,"Generator"),p(v,r,(function(){return this})),p(v,"toString",(function(){return"[object Generator]"})),(l=function(){return{w:i,m:y}})()}function p(t,n,e,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}p=function(t,n,e,r){if(n)o?o(t,n,{value:e,enumerable:!r,configurable:!r,writable:!r}):t[n]=e;else{var i=function(n,e){p(t,n,(function(t){return this._invoke(n,e,t)}))};i("next",0),i("throw",1),i("return",2)}},p(t,n,e,r)}function v(t,n,e,r,o,i,c){try{var a=t[i](c),u=a.value}catch(t){return void e(t)}a.done?n(u):Promise.resolve(u).then(r,o)}function y(t){return function(){var n=this,e=arguments;return new Promise((function(r,o){var i=t.apply(n,e);function c(t){v(i,r,o,c,a,"next",t)}function a(t){v(i,r,o,c,a,"throw",t)}c(void 0)}))}}r.config(),r.config();var h={Authorization:"Bearer ".concat(process.env.GITHUB_TOKEN),Accept:"application/vnd.github.v3+json","User-Agent":"PR-Reviewer-Bot"};function d(t,n,e){return b.apply(this,arguments)}function b(){return(b=y(l().m((function t(n,e,r){var o,c;return l().w((function(t){for(;;)switch(t.n){case 0:return o="https://api.github.com/repos/".concat(n,"/").concat(e,"/pulls/").concat(r,"/files"),t.n=1,i(o,{headers:h});case 1:return c=t.v,t.n=2,c.json();case 2:return t.a(2,t.v)}}),t)})))).apply(this,arguments)}function g(t,n,e,r){return m.apply(this,arguments)}function m(){return(m=y(l().m((function t(n,e,r,o){var c,a;return l().w((function(t){for(;;)switch(t.n){case 0:return c="https://api.github.com/repos/".concat(n,"/").concat(e,"/issues/").concat(r,"/comments"),t.n=1,i(c,{method:"POST",headers:h,body:JSON.stringify({body:o})});case 1:return a=t.v,t.n=2,a.json();case 2:return t.a(2,t.v)}}),t)})))).apply(this,arguments)}const w=require("cors");function O(){var t,n,e="function"==typeof Symbol?Symbol:{},r=e.iterator||"@@iterator",o=e.toStringTag||"@@toStringTag";function i(e,r,o,i){var u=r&&r.prototype instanceof a?r:a,f=Object.create(u.prototype);return j(f,"_invoke",function(e,r,o){var i,a,u,f=0,s=o||[],l=!1,p={p:0,n:0,v:t,a:v,f:v.bind(t,4),d:function(n,e){return i=n,a=0,u=t,p.n=e,c}};function v(e,r){for(a=e,u=r,n=0;!l&&f&&!o&&n<s.length;n++){var o,i=s[n],v=p.p,y=i[2];e>3?(o=y===r)&&(u=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=t):i[0]<=v&&((o=e<2&&v<i[1])?(a=0,p.v=r,p.n=i[1]):v<y&&(o=e<3||i[0]>r||r>y)&&(i[4]=e,i[5]=r,p.n=y,a=0))}if(o||e>1)return c;throw l=!0,r}return function(o,s,y){if(f>1)throw TypeError("Generator is already running");for(l&&1===s&&v(s,y),a=s,u=y;(n=a<2?t:u)||!l;){i||(a?a<3?(a>1&&(p.n=-1),v(a,u)):p.n=u:p.v=u);try{if(f=2,i){if(a||(o="next"),n=i[o]){if(!(n=n.call(i,u)))throw TypeError("iterator result is not an object");if(!n.done)return n;u=n.value,a<2&&(a=0)}else 1===a&&(n=i.return)&&n.call(i),a<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=t}else if((n=(l=p.n<0)?u:e.call(r,p))!==c)break}catch(n){i=t,a=1,u=n}finally{f=1}}return{value:n,done:l}}}(e,o,i),!0),f}var c={};function a(){}function u(){}function f(){}n=Object.getPrototypeOf;var s=[][r]?n(n([][r]())):(j(n={},r,(function(){return this})),n),l=f.prototype=a.prototype=Object.create(s);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,j(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return u.prototype=f,j(l,"constructor",f),j(f,"constructor",u),u.displayName="GeneratorFunction",j(f,o,"GeneratorFunction"),j(l),j(l,o,"Generator"),j(l,r,(function(){return this})),j(l,"toString",(function(){return"[object Generator]"})),(O=function(){return{w:i,m:p}})()}function j(t,n,e,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}j=function(t,n,e,r){if(n)o?o(t,n,{value:e,enumerable:!r,configurable:!r,writable:!r}):t[n]=e;else{var i=function(n,e){j(t,n,(function(t){return this._invoke(n,e,t)}))};i("next",0),i("throw",1),i("return",2)}},j(t,n,e,r)}function S(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,n){if(t){if("string"==typeof t)return P(t,n);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?P(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,a=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return c=t.done,t},e:function(t){a=!0,i=t},f:function(){try{c||null==e.return||e.return()}finally{if(a)throw i}}}}function P(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=Array(n);e<n;e++)r[e]=t[e];return r}function T(t,n,e,r,o,i,c){try{var a=t[i](c),u=a.value}catch(t){return void e(t)}a.done?n(u):Promise.resolve(u).then(r,o)}r.config();var _=t(),G=process.env.PORT||3e3;_.use(w()),_.use(t.json()),_.use(n.json({verify:function(t,n,e){t.rawBody=e}})),_.post("/webhook",function(){var t,n=(t=O().m((function t(n,e){var r,i,c,a,u,s,l,p,v,y,h,b,m,w;return O().w((function(t){for(;;)switch(t.n){case 0:if(o(n)){t.n=1;break}return t.a(2,e.status(401).send("Invalid signature"));case 1:if(r=n.headers["x-github-event"],i=n.body.action,"pull_request"!==r||!["opened","synchronize","reopened"].includes(i)){t.n=4;break}return c=n.body.pull_request,a=n.body.repository,u=a.owner.login,s=a.name,l=c.number,console.log("🔔 PR ".concat(i.toUpperCase(),": #").concat(c.number," - ").concat(c.title)),console.log("🔗 ".concat(c.html_url)),console.log("🔔 Processing PR #".concat(l," - ").concat(c.title)),t.n=2,d(u,s,l);case 2:p=t.v,v="",y=S(p);try{for(y.s();!(h=y.n()).done;)b=h.value,v+="\n\nFile: ".concat(b.filename,"\n```diff\n").concat(b.patch,"\n```")}catch(t){y.e(t)}finally{y.f()}return m="\nYou are a senior code reviewer. Review the following GitHub Pull Request diff and provide:\n\n1. Code refactoring suggestions\n2. Linting issues\n3. any error or vulnerability\n4. Mitigation or improvements\n\n".concat(v,"\n"),t.n=3,f(m);case 3:return w=t.v,t.n=4,g(u,s,l,"🤖 **AI Code Review Summary**\n\n".concat(w));case 4:e.status(200).send("Webhook received");case 5:return t.a(2)}}),t)})),function(){var n=this,e=arguments;return new Promise((function(r,o){var i=t.apply(n,e);function c(t){T(i,r,o,c,a,"next",t)}function a(t){T(i,r,o,c,a,"throw",t)}c(void 0)}))});return function(t,e){return n.apply(this,arguments)}}()),_.listen(G,(function(){console.log("🚀 Webhook server listening on port ".concat(G))}))})();
//# sourceMappingURL=server.bundle.mjs.map